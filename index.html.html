import { useState } from 'react'
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import Papa from 'papaparse'

export default function Home() {
  const [parts, setParts] = useState([])
  const [message, setMessage] = useState('')

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        const lookup = {
          '03L103469A': { 품목명: '헤드커버', 규격명: '국내X' },
          '8K0198381BN': { 품목명: '엔진미미', 규격명: '성수' },
          '03L103483': { 품목명: '헤드커버가스켓', 규격명: '엘링' },
          '03L911021C': { 품목명: '스타트모터', 규격명: 'HYPERX' },
        }

        const filledData = results.data.map((row: any) => {
          const match = lookup[row.부품번호]
          return {
            ...row,
            품목명: match?.품목명 || '',
            규격명: match?.규격명 || '',
          }
        })

        setParts(filledData)
        setMessage('')
      }
    })
  }

  const handleRegister = () => {
    setMessage('입력완료 ✅')
  }

  return (
    <div className="p-8 space-y-4">
      <h1 className="text-2xl font-bold">부품 견적 자동입력</h1>
      <Input type="file" accept=".csv" onChange={handleFileUpload} />

      {parts.length > 0 && (
        <table className="w-full mt-4 border">
          <thead className="bg-gray-200">
            <tr>
              <th className="border p-2">부품번호</th>
              <th className="border p-2">품목명</th>
              <th className="border p-2">규격명</th>
            </tr>
          </thead>
          <tbody>
            {parts.map((row: any, index) => (
              <tr key={index}>
                <td className="border p-2">{row.부품번호}</td>
                <td className="border p-2">{row.품목명}</td>
                <td className="border p-2">{row.규격명}</td>
              </tr>
            ))}
          </tbody>
        </table>
      )}

      {parts.length > 0 && (
        <Button onClick={handleRegister}>판매 등록</Button>
      )}

      {message && <p className="text-green-600 font-semibold mt-2">{message}</p>}
    </div>
  )
}
